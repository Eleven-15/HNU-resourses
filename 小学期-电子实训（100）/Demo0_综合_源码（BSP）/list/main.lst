C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE source\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\inc) DEBUG OBJECTEXTEND 
                    -PRINT(.\list\main.lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /******************  STCBSP ۺDemo˵STC_DemoV3.6 *************************** 
   2          STC_DemoV3ʾԴmain.cfunction.csong.cɣ£     
   3              1Key2л"ʾ"""ģʽģʽֵLEDʾģʽУ
   4                     ģʽ1ʵʱʱӣգ
   5                     ģʽ2ʵʱʱӣʱ룩
   6                     ģʽ3¶ȡղ
   7                     ģʽ4ֲ
   8                     ģʽ5FM
   9                     ģʽ6ࣨҪEXTϽӳģ飩
  10                     ģʽ7ӳ    ҪEXTϽӵӳģ飩
  11              2ʾܣ
  12                     ģʽ1£ʾʵʱʱRTC   "--" "" ˳"""ϡ
             -¡"
  13                     ģʽ2£ʾʵʱʱRTC   "ʱʱ-ַ-" "" ˳"ʱ""ϡ
             -¡"
  14                     ģʽ3£ʾ¶ȡADֵ"  ", ޲
  15                     ģʽ4£ʾ      "    " "" ͣ/ţ"ϡ""
             -"
  16                     ģʽ5£ʾ      "   ƵʣMHz" "" 浱ǰNVM´
             -ϵʱøò
  17                                                                                   "ϡ"""Ƶ
  18                     ģʽ6£ʾ       "       ֵcm"  ޲ 
  19                     ģʽ7£ʾ       "ADCֵ"  ޲  
  20               31ʱⷢ "Һã""STC-Bѧϰ"ñô֣ò120
             -0bpsıշʽɿյ"Һã"ı    
  21                  3̧ʱ1(115200bps,8,N,1) Hello  ֡ıտɷʽ
  22               4񶯴ֲţֲ"ͣ/"
  23               5дųӽʱУ1350Hz1ʱ䣩
  24               61˫ͨţ115200bps
  25                         յһ"AA 55"ͷС8ֽݰ򽫵7ֽ+1Բ2400bps򴮿2485EXT
             -ѡתݰ
  26                         ӿյݰ++룩򴮿1ת
  27               72ѡ485˫򵥹EXTTTL Uart˫˫λã2400bps
  28                         յһ"AA 55"ͷС8ֽݰ򽫵7ֽ+2IrתݰNEC_R05d
             -Э飩
  29               8շӿڣ
  30                         ӿյݰ++룩1000Hz300mS򴮿1ת
  31                         ݰͷΪ"AA 55"3ֽΪ F1Ƶʣ45ֽڣBCD룬Ƶֵ0
             -.1MHzЧ8871080
  32                                                                              6ֽݣЧ015     
             -  7ֽ+4
  33                                                      3ֽΪ F2RTCʱ루456ֽݣBCD룩Ч
             -7ֽ+4
  34                                                      3ֽΪ F3RTCգ456ֽݣBCD룩Ч7ֽ+4
  35                                                  ֵNVM
  36                                                  1000Hz600mS
  37                                                  򴮿1ת
  38          
  39          ƣɣ绰18008400450    202195գ2022620ո
  40          **********************************************************************************************************
             -*****************/
  41          
  42          /********************************** STCBSP Ver3.6 ˵ ***************************************************
             -*****************
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 2   

  43          STCBSPṩĵײֺ֧Ӧò㺯֧"STC-Bѧϰ"ͬʱ
  44               1ʾ
  45               2LEDָʾʾ
  46               3ʵʱʱ
  47               4¶ȹղ
  48               5ֲ
  49               6FM
  50               7EXTչӿڣӳӡࡢתPWMƣ4ѡ1
  51               8񶯴
  52               9
  53               10
  54               111ͨ
  55               122ͨţ485485ModBusEXTչӿڣ3ѡ1
  56               13ң
  57               14շͨ
  58               15ʧNVM洢DS1302ṩ31ֽڣM24C02ṩ256ֽڣ
  59          ʹ÷μģͷļ
  60          
  61            (1) ϵͳʱƵʿmain.c޸ SysClockֵλHz
  62                磺code long SysClock=11059200; ϵͳʱƵΪ11059200HzҲ11.0592MHz   
  63                ϵͳƵʱʵʹƵʣʱѡģһ£붨ʱصйܳ
  64            (2) ʹ÷
  65                    1ڹмmain.cļSTC_BSP.libļ
  66                    2main.cѡͷļҪʹÿѡģṩĺͷͱͷļ 
  67                          #include "STC15F2K60S2.H"        //룬"STC-Bѧϰ"ʹMCUָͷļ
  68                          #include "sys.H"                 //룬sysMySTC_OSȳͷļ
  69                          #include "display.H"             //ѡdisplayʾģ飩ͷļ          
  70                          #include "key.H"                 //ѡkeyģ飩ͷļ
  71                          #include "hall.H"                //ѡhallģ飩ͷļ
  72                          #include "Vib.h"                 //ѡVib񶯴ģ飩ͷļ                 
  73                          #include "beep.H"                //ѡbeepģ飩ͷļ         
  74                          #include "music.h"               //ѡmusicֲţͷļ  
  75                          #include "adc.h"                 //ѡadcչӿADCܣͷļ 
  76                          #include "uart1.h"               //ѡuart11ͨţͷļ
  77                          #include "uart2.h"               //ѡuart22ͨţͷļ
  78                          #include "stepmotor.h"           //ѡ      
  79                          #include "DS1302.h"              //ѡDS1302ʵʱʱ
  80                          #include "M24C02.h"              //ѡ24C02ʧԴ洢
  81                          #include "FM_Radio.h"            //ѡFM
  82                          #include "EXT.h"                 //ѡEXTչӿڣӳӡࡢתPWM
             -Ƶת
  83                          #include "IR.h"                  //ѡ38KHzͨ
  84                          
  85                    3MySTC_Init()sysʼִһΣ
  86                       MySTC_OS()sysȺӦwhile1ѭУ
  87                    4ѡģѡãʹģͷǰִһģṩӲ
             -sysм书ܵȣ
  88                          DisplayerInit();      //ʾģ 
  89                          KeyInit();            //ģ
  90                          BeepInit();           //ģ
  91                          MusicPlayerInit();    //
  92                          HallInit();           //ģ                      
  93                          VibInit();            //񶯴ģ          
  94                          AdcInit();            //ģתADCģ¶ȡա밴Key3EXTչӿ
             -ϵADC
  95                          StepMotorInit();      //ģ                    
  96                          DS1302Init();         //DS1302ʵʱʱ
  97                          FMRadioInit();        //FM           
  98                          EXTInit();            //չӿӳӡࡢתPWMEXT
             -Uart2֮Ӧã
  99                          Uart1Init();          //Uart11USBϣͨţ              
 100                          Uart2Init();          //Uart22485ӿUART485ӿModBusEXTչӿڣ
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 3   

             -ͨšUartʽģģ飩   202252޸ģ
 101                          IrInit();             //38KHzͨģ
 102                          
 103                        ˵вģ鲻ҪЩвģͷļ˵
 104                          
 105                    5sys͸ģ鹲ṩ¼
 106                          numEventSys1mS:              1mS¼                        "1ʱ"¼
 107                          enumEventSys10mS:            10mS¼                       "10ʱ"¼
 108                          enumEventSys100mS:           100mS¼                      "100ʱ"¼
 109                          enumEventSys1S:              1S¼                         "1ʱ"¼
 110                          enumEventKey:                ¼                       K1K2K3 """̧"
             -
 111                          enumEventHall:               ¼                 "ųӽ""ų뿪"
             -
 112                          enumEventVib:                񶯴¼                 񶯸⵽""¼
 113                          enumEventNav:                ¼                   5򡢻򰴼K3 ""
             -"̧"
 114                          enumEventXADC:               չӿһADCת¼  P1.0P1.1ȡһݣ
 115                          enumEventUart1Rxd            1յһϸʽݰ¼1USBPCͨ
 116                          enumEventUart2Rxd            2յһϸʽݰ¼2485UARTEXTUART
             -485ModBusЭ         202252޸ģ
 117                          enumEventIrRxd:              Irյһݰ           
 118                          
 119                          Щ¼Ӧ"ص"ӦsysṩSetEventCallBack()ûصϵ
             -ܡ
 120                          
 121                    6ѡģṩ;ʹ÷μ
 122                          ģͷļе˵
 123                          main.cṩƼܺͲʾ
 124                          ܼĵӦʾ
 125                      
 126          дɣ绰18008400450   2021226ƣ202251ո
 127          **************************************************************************/
 128          
 129          //******* û1ûļ *************
 130          #include "STC15F2K60S2.H"        //롣
 131          #include "sys.H"                 //롣
 132          #include "displayer.H" 
 133          #include "key.h"
 134          #include "hall.h"
 135          #include "Vib.h"
 136          #include "beep.h"
 137          #include "music.h"
 138          #include "adc.h"
 139          #include "uart1.h"
 140          #include "uart2.h"
 141          #include "stepmotor.h"
 142          #include "DS1302.h"
 143          #include "M24C02.h"
 144          #include "FM_Radio.h" 
 145          #include "EXT.h"
 146          #include "IR.h"   
 147          
 148          code unsigned long SysClock=11059200;         //롣ϵͳʱƵ(Hz)û޸ĳʵʹƵ
             -ʣʱѡģһ
 149          #ifdef _displayer_H_                          //ʾģѡʱ롣ʾÑ޸ġӵ
             - 
 150          code char decode_table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x00,0x08,0x40,0x01, 0x41, 0x4
             -8, 
 151                          /* :   0   1    2    3    4     5    6    7   8    9   10    11   12   13    14     15    
             - */
 152                          /* ʾ:   0   1    2    3    4     5    6    7   8    9  ()   -  -  -  -  
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 4   

             --   */  
 153                                   0x3f|0x80,0x06|0x80,0x5b|0x80,0x4f|0x80,0x66|0x80,0x6d|0x80,0x7d|0x80,0x07|0x80,0x
             -7f|0x80,0x6f|0x80 };  
 154                       /* С     0         1         2         3         4         5         6         7      
             -   8         9        */
 155          #endif
 156          //******* û2ûԶ庯 *************//
 157          
 158          
 159          //******* û3ûȫֱ *************//
 160          #include "song.c"                              //song.cбд֣ͬһ׸裩
 161          
 162          struct_DS1302_RTC t={0x30,0,9,0x06,9,1,0x21};  // ʵʱʱݽṹ롢֡ʱա¡ܡꡣֵ
             -202196գһ90030
 163          struct_FMRadio    FM;                          // FMݽṹƵʡGP1GP2GP3
             -ֵ95.5MHz5
 164          struct_SysPerF    SysPer;                      // ϵͳݽṹÿѭ4ֽڡÿѯ
             -1ֽ
 165          struct_ADC        ADCresult;                   // ADֵ           
 166          unsigned char Music_tone,Music_PM;             // ֲڴգÿӽ
 167          
 168          unsigned char rxd[8];                         //ͨţ12⹲ã8ֽ
 169          code unsigned char rxdhead[2]={0xaa,0x55};      //ͨţ12հͷƥַ2ֽڣ0xAA
             -0x55    
 170          // unsigned char rxdhead[1]={0x1};               //2ModBusЭ֡һֽID=1ʾ  
 171          
 172          unsigned char funcmode;                  //ʾģʽ
 173          enum funcname {RTC_YMD=1,                      //ģʽʵʱʱӣ
 174                         RTC_HMS,                        //                    ʵʱʱӣʱ
 175                         Rt_Rop,                         //                    
 176                         Music,                          //                    ֲ
 177                         FMradio,                        //                    FM
 178                         UltroSonic,                     //                    
 179                         Weight};                        //                    ӳ
 180          unsigned char tempadj;                   //ʱʱã=1 ʱ=2 » =3  
             -
 181          
 182          //******* û4ûԶ庯ԭ *************//
 183          
 184          #include "function.c"                          //û
 185          
 186          void myUart1Rxd_callback()                    //1յϷݰصϷݰAA55.
             -.....8ֽڣ
 187          { if ( GetUart2TxStatus() == enumUart2TxFree )                  
 188   1          { (*(rxd+6)) += 1;                                          //7ֽڼ1
 189   2             Uart2Print(&rxd, sizeof(rxd));                           //ݰӴ2(485EXTչӿ)
             -ȥ
 190   2          }     
 191   1      }
 192          
 193          // void myUart2Rxd_callback()                    //2յϷݰصϷݰAA55
             -......8ֽڣ
 194          // { if ( GetUart1TxStatus() == enumUart1TxFree ) 
 195          //   { (*(rxd+6)) += 2;                                             //7ֽڼ2
 196          //     Uart1Print(&rxd, sizeof(rxd));                                  //ݰӴ1ͳȥ
 197          //   }
 198          // }
 199          
 200          // void myUart2Rxd_callback()                    //2յModBusЭصϷݰModB
             -usЭ֡IDƥ䣩
 201          // { if ( GetUart1TxStatus() == enumUart1TxFree ) 
 202          //   { (*(rxd+6)) += 2;                                             //7ֽڼ2
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 5   

 203          //     Uart1Print(&rxd, sizeof(rxd));                               //ջӴ1ͳȥModBus
             -֡СδжϣCRCδУ飩
 204          //   }
 205          // }
 206          
 207          void myUart2Rxd_callback()                    //2յϷݰصϷݰAA55.
             -.....8ֽڣ
 208          { if ( GetIrStatus() == enumIrFree ) 
 209   1         { (*(rxd+6)) += 2;                                             //7ֽڼ2
 210   2           IrPrint(&rxd, sizeof(rxd));                                  //ݰӺⷢͳȥ
 211   2         }
 212   1      }
 213          
 214          void myIrRxd_callback()                      //յݰصкǰ++NEC_R
             -05d룩  
 215          { dealwithIrRxd();  
 216   1      }
 217          
 218          void my1mS_callback()                       //1mS¼ص
 219          {  
 220   1      }
 221            
 222          void my10mS_callback()                      //10mS¼ص
 223          { 
 224   1      }
 225          
 226          void my100mS_callback()                     //100mS¼ص
 227          { dealwithDisp();                          
 228   1      }      
 229                         
 230          void my1S_callback()                       //1S¼ص
 231          {   
 232   1      }
 233          
 234          void myADC_callback()                      //ADC¼ص
 235          { 
 236   1      }
 237          
 238          void myKN_callback()                                                                              //
             -¼ص
 239          { dealwithmyKN();   
 240   1      }
 241          
 242          void mykey_callback()                               // Key1Key2¼ص
 243          { dealwithmykey();    
 244   1      }
 245          
 246          void myhall_callback()                                                                    //ʾhall¼
             -ص
 247          { if(GetHallAct() == enumHallGetClose) SetBeep(1350,100);   
 248   1      }
 249          
 250          void mySV_callback()                                                                      //ʾ: ¼
             -ֲ/ͣ
 251          { if(GetVibAct())
 252   1        if (GetPlayerMode() == enumModePause) SetPlayerMode(enumModePlay); 
 253   1            else  SetPlayerMode(enumModePause);     
 254   1      }
 255          
 256          //******* main() *************//  
 257          void main() {         // main() ʼ         //б룡 
 258   1        
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 6   

 259   1      //******* û5ûmain()ڲֲ *************//
 260   1        
 261   1      //******* û6ûmain()ʼ *************//   
 262   1      //1,Ҫõģ(ɸģṩغ)
 263   1          KeyInit();                                      //Ҫõģ鼰亯ʼ
             -׼Ӧ̨
 264   1          HallInit();                                      //
 265   1          VibInit();                                       //
 266   1          DisplayerInit();                                 //
 267   1          BeepInit();                                      //
 268   1          MusicPlayerInit();                               //
 269   1          AdcInit(ADCexpEXT);                              //ADCģʼвѡչӿEXTP1.0
             -P1.1ǷҲADC
 270   1          StepMotorInit();                                 //ʼ
 271   1          DS1302Init(t);                                   //DS1302ʼ
 272   1            
 273   1          IrInit(NEC_R05d);                                //ӿ
 274   1          /******* ¿4ѡ1EXTӿ ********/    
 275   1      //    EXTInit(enumEXTWeight);                          //EXTʼɵӳӹ
 276   1      //    EXTInit(enumEXTPWM);                             //EXTʼ·PWM
 277   1      //    EXTInit(enumEXTDecode);                          //EXTʼʽ빦ܣ磺ת
             -
 278   1      //    EXTInit(enumEXTUltraSonic);                      //EXTʼɳ๦
 279   1           Uart1Init(115200);                                //1ʼвUart1ͨŲ
 280   1          /******* ¿2ѡ1ش2 ********/    
 281   1      //     Uart2Init(9600,Uart2Usedfor485ModBus);            //2ʼ485ӿ֧ModBusЭ飨RS485
             -ҵֳߣ˫ModBusЭ⣩
 282   1           Uart2Init(2400,Uart2Usedfor485);                  //2ʼ485ӿڣRS485ҵֳߣ
             -˫
 283   1      //    Uart2Init(9600,Uart2UsedforEXT);                 //2ʼEXTӿڣTTL Uartͨſڣ
 284   1          
 285   1      //2,¼ص(sysṩúSetEventCallBack()) 
 286   1          SetEventCallBack(enumEventKey, mykey_callback);            //
 287   1          SetEventCallBack(enumEventSys1mS, my1mS_callback);         //
 288   1          SetEventCallBack(enumEventSys10mS, my10mS_callback);       //
 289   1          SetEventCallBack(enumEventSys100mS, my100mS_callback);     //
 290   1          SetEventCallBack(enumEventSys1S, my1S_callback);           //
 291   1          SetEventCallBack(enumEventHall, myhall_callback);          //
 292   1          SetEventCallBack(enumEventVib, mySV_callback);             //
 293   1          SetEventCallBack(enumEventNav, myKN_callback);             //õص
 294   1          SetEventCallBack(enumEventUart1Rxd, myUart1Rxd_callback);  //ô1ջص
 295   1          SetEventCallBack(enumEventUart2Rxd, myUart2Rxd_callback);  //ô2ջص
 296   1          SetEventCallBack(enumEventXADC,myADC_callback);            //չӿµADֵ¼
 297   1          SetEventCallBack(enumEventIrRxd,myIrRxd_callback);         //Irյһݰ
 298   1      
 299   1      //3,û״̬ʼ  
 300   1          SetDisplayerArea(0,7);                           //
 301   1          SetUart1Rxd(&rxd, sizeof(rxd), rxdhead, sizeof(rxdhead));   //ôڽշʽݰݰ
             -rxdУݰСrxdСݰͷҪrxdheadƥ䣬ƥrxdheadС
 302   1          SetUart2Rxd(&rxd, sizeof(rxd), rxdhead, sizeof(rxdhead)); 
 303   1          SetIrRxd(&rxd,sizeof(rxd));                                 //
 304   1          
 305   1      //4,ûʼ
 306   1          FM=FM_NVMread();                              //FMRadioʼ
 307   1          FMRadioInit(FM);  
 308   1          
 309   1          Music_PM=90;
 310   1          Music_tone=0xFC;
 311   1          funcmode = M24C02_Read(0x00);                               
 312   1          LedPrint(funcmode); 
 313   1          
 314   1      /*****************  MySTC_OS ʼؿʼ  ********************************/   
C51 COMPILER V9.54   MAIN                                                                  07/25/2023 16:48:47 PAGE 7   

 315   1          MySTC_Init();     // MySTC_OS ʼ         //б룡   
 316   1        while(1)            // ϵͳѭ              //б룡     
 317   1          { MySTC_OS();     // MySTC_OS            //б룡
 318   2      /*****************  MySTC_OS ʼؽ  ********************************/  
 319   2            
 320   2      //******* û7ûmain()ѭ *************//
 321   2            
 322   2            
 323   2          }               //ѭwhile(1)         //б룡 
 324   1      }                   // main()          //б룡 
 325          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3088    ----
   CONSTANT SIZE    =    336    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     41      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
