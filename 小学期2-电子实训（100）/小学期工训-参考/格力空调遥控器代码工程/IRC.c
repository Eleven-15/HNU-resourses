#include"device.c"
/******************格力空调指令码******************/
xdata uint8 GreeInstructions[30][9]={{0x41,0x00,0x20,0x50,0x02,0x01,0x20,0x00,0xd4},//16度，开->关，上下扫风，制冷模式，节能开启
															{0x49,0x00,0x20,0x50,0x02,0x01,0x20,0x00,0x50},//16度，关->开，上下扫风，制冷模式
															{0x41,0x01,0x20,0x50,0x02,0x01,0x20,0x00,0xe0},//17度，开->关，上下扫风，制冷模式
															{0x49,0x01,0x20,0x50,0x02,0x01,0x20,0x00,0x60},//17度，关->开，上下扫风，制冷模式
															{0x41,0x02,0x20,0x50,0x02,0x01,0x20,0x00,0xf0},//18度，开->关，上下扫风，制冷模式
															{0x49,0x02,0x20,0x50,0x02,0x01,0x20,0x00,0x70},//18度，关->开，上下扫风，制冷模式
															{0x41,0x03,0x20,0x50,0x02,0x01,0x20,0x00,0x00},//19度，开->关，上下扫风，制冷模式
															{0x49,0x03,0x20,0x50,0x02,0x01,0x20,0x00,0x80},//19度，关->开，上下扫风，制冷模式
															{0x41,0x04,0x20,0x50,0x02,0x01,0x20,0x00,0x10},//20度，开->关，上下扫风，制冷模式
															{0x49,0x04,0x20,0x50,0x02,0x01,0x20,0x00,0x90},//20度，关->开，上下扫风，制冷模式
															{0x41,0x05,0x20,0x50,0x02,0x01,0x20,0x00,0x20},//21度，开->关，上下扫风，制冷模式
															{0x49,0x05,0x20,0x50,0x02,0x01,0x20,0x00,0xa0},//21度，关->开，上下扫风，制冷模式
															{0x41,0x06,0x20,0x50,0x02,0x01,0x20,0x00,0x30},//22度，开->关，上下扫风，制冷模式
															{0x49,0x06,0x20,0x50,0x02,0x01,0x20,0x00,0xb0},//22度，关->开，上下扫风，制冷模式
															{0x41,0x07,0x20,0x50,0x02,0x01,0x20,0x00,0x40},//23度，开->关，上下扫风，制冷模式
															{0x49,0x07,0x20,0x50,0x02,0x01,0x20,0x00,0xc0},//23度，关->开，上下扫风，制冷模式
															{0x41,0x08,0x20,0x50,0x02,0x01,0x20,0x00,0x50},//24度，开->关，上下扫风，制冷模式
															{0x49,0x08,0x20,0x50,0x02,0x01,0x20,0x00,0xd0},//24度，关->开，上下扫风，制冷模式
															{0x41,0x09,0x20,0x50,0x02,0x01,0x20,0x00,0x60},//25度，开->关，上下扫风，制冷模式
															{0x49,0x09,0x20,0x50,0x02,0x01,0x20,0x00,0xe0},//25度，关->开，上下扫风，制冷模式
															{0x41,0x0a,0x20,0x50,0x02,0x01,0x20,0x00,0x70},//26度，开->关，上下扫风，制冷模式
															{0x49,0x0a,0x20,0x50,0x02,0x01,0x20,0x00,0xf0},//26度，关->开，上下扫风，制冷模式
															{0x41,0x0b,0x20,0x50,0x02,0x01,0x20,0x00,0x80},//27度，开->关，上下扫风，制冷模式
															{0x49,0x0b,0x20,0x50,0x02,0x01,0x20,0x00,0x00},//27度，关->开，上下扫风，制冷模式
															{0x41,0x0c,0x20,0x50,0x02,0x01,0x20,0x00,0x90},//28度，开->关，上下扫风，制冷模式
															{0x49,0x0c,0x60,0x50,0x02,0x01,0x20,0x00,0x10},//28度，关->开，上下扫风，制冷模式
															{0x41,0x0d,0x20,0x50,0x02,0x01,0x20,0x00,0xa0},//29度，开->关，上下扫风，制冷模式
															{0x49,0x0d,0x20,0x50,0x02,0x01,0x20,0x00,0x20},//29度，关->开，上下扫风，制冷模式
															{0x41,0x0e,0x20,0x50,0x02,0x01,0x20,0x00,0xb0},//30度，开->关，上下扫风，制冷模式
															{0x49,0x0e,0x20,0x50,0x02,0x01,0x20,0x00,0x30}//30度，关->开，上下扫风，制冷模式
															};//27度
				

/*
*发送起始码函数
*/														
void SendS(){
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	IRFLAG=1;
	TR1=1;
	while(timer0Num<TIMER19000USNUM);
	IRFLAG=0;
	TR1=0;
	timer0Num=0;
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	TR1=1;
	while(timer0Num<TIMER14500USNUM);
	TR1=0;
	timer0Num=0;
}
/*
*发送连接码函数
*/
void SendC(){
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	IRFLAG=1;
	TR1=1;
	while(timer0Num<TIMER1600USNUM);
	IRFLAG=0;
	TR1=0;
	timer0Num=0;
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	TR1=1;
	while(timer0Num<TIMER120000USNUM);
	TR1=0;
	timer0Num=0;
}

/*
*发送一个bit为0的函数
*/
void Send1(){
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	IRFLAG=1;
	TR1=1;
	while(timer0Num<TIMER1600USNUM);
	IRFLAG=0;
	TR1=0;
	timer0Num=0;
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	TR1=1;
	while(timer0Num<TIMER11600USNUM);
	TR1=0;
	timer0Num=0;
}

/*
*发送一个bit为1的函数
*/
void Send0(){
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	IRFLAG=1;
	TR1=1;
	while(timer0Num<TIMER1600USNUM);
	IRFLAG=0;
	TR1=0;
	timer0Num=0;
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	TR1=1;
	while(timer0Num<TIMER1600USNUM);
	TR1=0;
	timer0Num=0;
}

/*
*发送一整条指令函数
*/
void SendInstructions(uint8 openORClose,uint8 temperature){
	uint8 i,j,temp,k=0;
	k=openORClose+(temperature-16)*2;
	SendS();
	for(i=0;i<5;i++)
	{
		temp=GreeInstructions[k][i];
		for(j=0;j<8;j++)
		{
			if((i==4)&&(j==3))
					break;
			if(temp&0x01)
				Send1();
			else 
				Send0();
		temp=temp>>1;
		}
	}
	SendC();
	for(i=5;i<9;i++)
	{
		temp=GreeInstructions[k][i];
		for(j=0;j<8;j++)
		{
			if(temp&0x01)
				Send1();
			else 
				Send0();
			temp=temp>>1;
		}
	}
	TH1=TIMER113USTH1;
	TL1=TIMER113USTL1;
	IRFLAG=1;
	TR1=1;
	while(timer0Num<TIMER1600USNUM);
	IRFLAG=0;
	TR1=0;
	timer0Num=0;
}	