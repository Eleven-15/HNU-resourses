# Rainw Love skirt题解

### 题意：

给$n$个点的树，树边有边权，$n$个点被划分为$m$个不相交的集合，且保证每个集合至少有$200$个点。

$q$次查询，每次查询$X,Y$：两个集合$X$,$Y$的所有点构成集合$A$，令$f(x)$表示$x$到$A$中点的最大距离，求$min_{u\in X}(f(u))$， 题目保证$|X|\le|Y|$

数据范围:$n,m,q \le 5e4$

### 解题思路：

​	对于一个集合，维护对应的直径$(u,v)$，那么由于：”对于树上任一点$x$来说，离他最远的点一定可以是直径的端点“，所以对于这个集合里面的点$x$来说，$f(x)=max( dis(x,u), dis(x,v) )$。因此对于一个集合如果我们知道直径$(u,v)$, 我们就可以遍历集合$X$的每一个元素来求出最小的$f(x)$. 这样利用st表O(1)去求lca, 单次复杂度就是$O(|X|)$.

​	因此这题的做法就是:

1. 维护每个集合的直径
2. 查询的时候,O(1)求出两个直径合并的结果, 再遍历起点集合的所有元素进行查询
3. 把查询过的 $(x,y)$ 记忆化,下次再查相同的内容就直接返回



​	复杂度分析: 

​	对于一个大小为B的集合，最多有n/B个比它大的集合，因为较大的集合是预处理出直径无需暴力的，因此计算需要暴力的点的部分的复杂度上限：因为加了记忆化，对任意B，大小>B的集合，需要暴力的次数不会超过n/B，大小<B的集合，单次暴力复杂度只有B，因此复杂度上限是  max ( B + n/B ) ，当B = sqrt(n)的时候取到最值 $2n\sqrt n$，因此复杂度为 $O(q + n\sqrt n$

